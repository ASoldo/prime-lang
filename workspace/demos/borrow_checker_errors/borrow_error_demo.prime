//! Borrow-checker scoping demo.
//!
//! Uses nested blocks to show where a mutable borrow ends, so a later borrow of
//! the same value is legal.
module demos::borrow_checker_errors;

/// Uses nested blocks to ensure each `&mut` borrow stays scoped.
fn nested_borrow_release() {
  let mut int32 gauge = 20;
  let int32 snapshot = gauge;
  {
    let &mut int32 escaping = {
      if gauge > 15 {
        &mut gauge
      } else {
        &mut gauge
      }
    };
    *escaping = snapshot + 5;
    out(`escaping alias now {}`, *escaping);
  }
  {
    let &mut int32 scoped = &mut gauge;
    *scoped = *scoped - 2;
    out(`scoped adjustment {}`, *scoped);
  }

  let &mut int32 after_scope = &mut gauge;
  *after_scope = *after_scope + 1;
  out(`gauge stabilized at {gauge}`);
}

/// Entry point for the scoping demo.
fn main() {
  nested_borrow_release();
}
